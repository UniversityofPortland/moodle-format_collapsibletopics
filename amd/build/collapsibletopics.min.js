define(["jquery","core/log"],function(a,b){"use strict";var c=function(a,b,c){"local"==c?window.localStorage.setItem("sections-toggle-"+a,JSON.stringify(b)):"session"==c&&window.sessionStorage.setItem("sections-toggle-"+a,JSON.stringify(b))},d=function(a,b){var c;return"local"==b?c=window.localStorage.getItem("sections-toggle-"+a):"session"==b&&(c=window.sessionStorage.getItem("sections-toggle-"+a)),null===c?{}:JSON.parse(c)};return{init:function(e){b.debug("Format collapsibletopics AMD module initialized"),a(document).ready(function(a){var b,f,g=e.keepstateoversession;f=1==g?"local":"session",b=d(e.course,f),setTimeout(function(){for(var c in b)c="#collapse-"+parseInt(c),a(c).collapse("show");var d=a(".section.current a.sectiontoggle").attr("href");a(d).collapse("show")},50),a("body").on("click",".expandall",function(d){d.preventDefault();var g=d.target;a(g).removeClass("expandall").addClass("collapseall").html(M.util.get_string("collapseall","moodle")),a(".sectiontoggle").each(function(d){var g="#collapse-"+(d+1);a(g).collapse("show"),b.hasOwnProperty(d+1)||(b[d+1]="true",c(e.course,b,f))})}),a("body").on("click",".collapseall",function(d){d.preventDefault();var g=d.target;a(g).removeClass("collapseall").addClass("expandall").html(M.util.get_string("expandall","moodle")),a(".sectiontoggle").each(function(d){var g="#collapse-"+(d+1);a(g).collapse("hide"),b.hasOwnProperty(d+1)&&(delete b[d+1],c(e.course,b,f))})}),a("#nav-drawer div.media").on("click",function(b){var c=a(b.target).parent().parent().parent().attr("href");if(c.lastIndexOf("#section-")!=-1){var d=c.substring(c.lastIndexOf("-")+1),e="#collapse-"+d;a(e).collapse("show")}}),a(".collapse").on("show.bs.collapse",function(d){var g=a(d.target).attr("id"),h=g.substring(g.lastIndexOf("-")+1);b.hasOwnProperty(h)||(b[h]="true",c(e.course,b,f))}),a(".collapse").on("hide.bs.collapse",function(d){var g=a(d.target).attr("id"),h=g.substring(g.lastIndexOf("-")+1);b.hasOwnProperty(h)&&(delete b[h],c(e.course,b,f))}),a("body").on("click",".togglecompletion button",function(b){var c=b.target,d=a(c).parent().parent().children('input[name="completionstate"]').val(),e=a(c).closest("li.section"),f=a(e).find(".progress-bar"),g=parseInt(a(f).attr("aria-valuenow")),h=1==d?g+1:g-1,i=Math.round(h/parseInt(a(f).attr("aria-valuemax"))*100);a(f).attr("aria-valuenow",h),a(f).attr("style","width: "+i+"%"),a(f).attr("data-original-title",""+i+"%")})})}}});