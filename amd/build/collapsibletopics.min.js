define(["jquery","core/log"],function(a,b){"use strict";return{init:function(c){b.debug("Format collapsibletopics AMD module initialized"),a(document).ready(function(a){var b=JSON.parse(c.sectionstoggle);setTimeout(function(){for(var c in b)c="#collapse-"+parseInt(c),a(c).collapse("show");var d=a(".section.current a.sectiontoggle").attr("href");a(d).collapse("show")},50),a("body").on("click",".expandall",function(d){d.preventDefault();var e=d.target;a(e).removeClass("expandall").addClass("collapseall").html(M.util.get_string("collapseall","moodle")),a(".sectiontoggle").each(function(d){var e="#collapse-"+(d+1);a(e).collapse("show"),b.hasOwnProperty(d+1)||(b[d+1]="true",M.util.set_user_preference("sections-toggle-"+c.course,JSON.stringify(b)))})}),a("body").on("click",".collapseall",function(d){d.preventDefault();var e=d.target;a(e).removeClass("collapseall").addClass("expandall").html(M.util.get_string("expandall","moodle")),a(".sectiontoggle").each(function(d){var e="#collapse-"+(d+1);a(e).collapse("hide"),b.hasOwnProperty(d+1)&&(delete b[d+1],M.util.set_user_preference("sections-toggle-"+c.course,JSON.stringify(b)))})}),a("#nav-drawer div.media").on("click",function(b){var c=a(b.target).parent().parent().parent().attr("href");if(c.lastIndexOf("#section-")!=-1){var d=c.substring(c.lastIndexOf("-")+1),e="#collapse-"+d;a(e).collapse("show")}}),a(".collapse").on("show.bs.collapse",function(d){var e=a(d.target).attr("id"),f=e.substring(e.lastIndexOf("-")+1);b.hasOwnProperty(f)||(b[f]="true",M.util.set_user_preference("sections-toggle-"+c.course,JSON.stringify(b)))}),a(".collapse").on("hide.bs.collapse",function(d){var e=a(d.target).attr("id"),f=e.substring(e.lastIndexOf("-")+1);b.hasOwnProperty(f)&&(delete b[f],M.util.set_user_preference("sections-toggle-"+c.course,JSON.stringify(b)))}),a("body").on("click",".togglecompletion button",function(b){var c=b.target,d=a(c).parent().parent().children('input[name="completionstate"]').val(),e=a(c).closest("li.section"),f=a(e).find(".progress-bar"),g=parseInt(a(f).attr("aria-valuenow")),h=1==d?g+1:g-1,i=h/parseInt(a(f).attr("aria-valuemax"))*100;a(f).attr("aria-valuenow",h),a(f).attr("style","width: "+i+"%")})})}}});